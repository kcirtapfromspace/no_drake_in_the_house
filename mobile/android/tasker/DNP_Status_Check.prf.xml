<?xml version="1.0" encoding="UTF-8"?>
<TaskerData sr="" dvi="1" tv="6.0.9">
    <Profile sr="prof4" ve="2">
        <cdate>1640995200000</cdate>
        <edate>1640995200000</edate>
        <id>4</id>
        <mid0>5</mid0>
        <nme>DNP Status Check</nme>
        <Event sr="con0" ve="2">
            <code>23</code>
            <pri>0</pri>
            <Str sr="arg0" ve="3">house.nodrakeinthe.CHECK_STATUS_VOICE</Str>
            <Str sr="arg1" ve="3"></Str>
            <Str sr="arg2" ve="3"></Str>
        </Event>
    </Profile>
    
    <Task sr="task5">
        <cdate>1640995200000</cdate>
        <edate>1640995200000</edate>
        <id>5</id>
        <nme>Check DNP Status</nme>
        <pri>100</pri>
        
        <!-- Send intent to check status -->
        <Action sr="act0" ve="7">
            <code>125</code>
            <label>Check Status via Intent</label>
            <Str sr="arg0" ve="3">house.nodrakeinthe.TASKER_CHECK_STATUS</Str>
            <Str sr="arg1" ve="3"></Str>
            <Str sr="arg2" ve="3"></Str>
            <Str sr="arg3" ve="3"></Str>
            <Str sr="arg4" ve="3"></Str>
            <Str sr="arg5" ve="3"></Str>
            <Str sr="arg6" ve="3"></Str>
            <Str sr="arg7" ve="3"></Str>
            <Int sr="arg8" val="0"/>
        </Action>
        
        <!-- Wait for result -->
        <Action sr="act1" ve="7">
            <code>30</code>
            <label>Wait for Result</label>
            <Int sr="arg0" val="5"/>
        </Action>
        
        <!-- Check if successful -->
        <Action sr="act2" ve="7">
            <code>37</code>
            <label>Check Success</label>
            <ConditionList sr="if">
                <Condition sr="c0" ve="3">
                    <lhs>%success</lhs>
                    <op>2</op>
                    <rhs>true</rhs>
                </Condition>
            </ConditionList>
        </Action>
        
        <!-- Format connected services -->
        <Action sr="act3" ve="7">
            <code>590</code>
            <label>Format Services</label>
            <Str sr="arg0" ve="3">%connected_services</Str>
            <Str sr="arg1" ve="3">,</Str>
            <Str sr="arg2" ve="3"> and </Str>
            <Str sr="arg3" ve="3">%services_text</Str>
        </Action>
        
        <!-- Speak status -->
        <Action sr="act4" ve="7">
            <code>540</code>
            <label>Speak Status</label>
            <Str sr="arg0" ve="3">You have %dnp_count artists in your do not play list. You have %services_text connected. Last enforcement was %last_enforcement.</Str>
            <Str sr="arg1" ve="3">en-US</Str>
            <Int sr="arg2" val="5"/>
            <Int sr="arg3" val="5"/>
            <Str sr="arg4" ve="3"></Str>
            <Int sr="arg5" val="0"/>
            <Int sr="arg6" val="1"/>
        </Action>
        
        <!-- Show notification with details -->
        <Action sr="act5" ve="7">
            <code>523</code>
            <label>Status Notification</label>
            <Str sr="arg0" ve="3">DNP Status</Str>
            <Str sr="arg1" ve="3">%dnp_count artists blocked
%services_text connected
Last: %last_enforcement</Str>
            <Str sr="arg2" ve="3">mdi:shield-check</Str>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
            <Str sr="arg5" ve="3"></Str>
            <Str sr="arg6" ve="3"></Str>
        </Action>
        
        <!-- Error case -->
        <Action sr="act6" ve="7">
            <code>43</code>
            <label>Else</label>
        </Action>
        
        <!-- Error notification -->
        <Action sr="act7" ve="7">
            <code>523</code>
            <label>Error Notification</label>
            <Str sr="arg0" ve="3">DNP Manager</Str>
            <Str sr="arg1" ve="3">Failed to get status: %error</Str>
            <Str sr="arg2" ve="3">mdi:alert-circle</Str>
            <Int sr="arg3" val="0"/>
            <Int sr="arg4" val="0"/>
            <Str sr="arg5" ve="3"></Str>
            <Str sr="arg6" ve="3"></Str>
        </Action>
        
        <!-- Speak error -->
        <Action sr="act8" ve="7">
            <code>540</code>
            <label>Speak Error</label>
            <Str sr="arg0" ve="3">Sorry, I couldn't get your DNP status. %error</Str>
            <Str sr="arg1" ve="3">en-US</Str>
            <Int sr="arg2" val="5"/>
            <Int sr="arg3" val="5"/>
            <Str sr="arg4" ve="3"></Str>
            <Int sr="arg5" val="0"/>
            <Int sr="arg6" val="1"/>
        </Action>
        
        <!-- End if -->
        <Action sr="act9" ve="7">
            <code>38</code>
            <label>End If</label>
        </Action>
    </Task>
</TaskerData>